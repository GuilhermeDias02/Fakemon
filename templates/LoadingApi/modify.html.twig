{% extends 'base.html.twig' %}

{% block body %}

    <div id="pokemonFormContainer"></div>

    <script>
        // Function to fetch Pokemon data by ID
        function fetchPokemonById(id) {
            return fetch(`http://127.0.0.1:8000/api/pokemon/${id}`, {
                method: 'GET',
                headers: {
                    'Content-Type': 'application/ld+json',
                    // You might need to include additional headers like authentication
                },
            }).then(response => response.json());
        }

        // Function to create a form with Pokemon data
        function createPokemonForm(pokemon) {
            // Create a form element
            var formElement = document.createElement('form');

            // Add a form group for each property
            for (var prop in pokemon) {
                var formGroup = document.createElement('div');
                formGroup.className = 'form-group';

                var label = document.createElement('label');
                label.textContent = prop;
                formGroup.appendChild(label);

                var input = document.createElement('input');
                input.className = 'form-control';
                input.name = prop;
                input.value = pokemon[prop];
                formGroup.appendChild(input);

                // Add the form group to the form
                formElement.appendChild(formGroup);
            }

            // Add a submit button
            var submitButton = document.createElement('button');
            submitButton.type = 'submit';
            submitButton.className = 'btn btn-primary';
            submitButton.textContent = 'Submit';
            formElement.appendChild(submitButton);

            return formElement;
        }


function removeLeadingZeros(str) {
    // Utiliser une expression régulière pour supprimer les zéros à gauche
    return str.replace(/^0+/, '');
}
        // Function to handle form submission
        function submitForm(event) {
            event.preventDefault();


            // Get the form data
            var formData = new FormData(event.target);
            var idPokedexValue = formData.get('idPokedex');
            var idNat = parseInt(removeLeadingZeros(idPokedexValue));
            formData.set('idNat', idNat);
            console.log(formData.get('idNat'));
            // Convert FormData to JSON object
            var jsonFormData = {};
            console.log(jsonFormData);
            formData.forEach((value, key) => {
                if (key === "idNat") {
                    jsonFormData[key] = typeof value === 'number' ? value : parseInt(value, 10);
                } else {
                    jsonFormData[key] = value;
                }
            });


            // Get the Pokemon ID from the server (you need to set this dynamically)
            var pokemonId = {{ id }}; // Replace with your dynamic ID

            // Send a PATCH request with the updated data
            fetch(`http://127.0.0.1:8000/api/pokemon/${pokemonId}`, {
                method: 'PATCH',
                headers: {
                    'Content-Type': 'application/merge-patch+json',
                    // You might need to include additional headers like authentication
                },
                body: JSON.stringify(jsonFormData),
            })
                .then(response => response.json())
                .then(updatedData => {
                    console.log('Pokemon updated successfully:', updatedData);
                })
                .catch(error => console.error('Error updating Pokemon:', error));
        }

        // Get the Pokemon ID from the server (you need to set this dynamically)
        var pokemonId = {{ id }}; // Replace with your dynamic ID

        // Fetch Pokemon data by ID
        fetchPokemonById(pokemonId)
            .then(data => {
                // Create a form with Pokemon data
                var form = createPokemonForm(data);

                // Add an event listener for form submission
                form.addEventListener('submit', submitForm);

                // Append the form to the container
                document.getElementById('pokemonFormContainer').appendChild(form);
            })
            .catch(error => console.error('Error fetching Pokemon data:', error));
    </script>

{% endblock %}
